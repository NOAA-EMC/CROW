This section is designed for users who are experienced users of the legacy configuration system. For these users, they may feel writing by their left hand for several days but it will get better soon.

Go-\/over the quick end-\/to-\/end with the tutorial case, make sure you understand the role of each step. Create a simple rocoto xml with legacy configuration system, put it side-\/by-\/side with the one generated from C\-R\-O\-W based system’s quick end-\/to-\/end. Search for variables that makes the two X\-M\-Ls different, then add them into proper section of your case file according to variable lists in Appendix b. Rerun C\-R\-O\-W script step 1 and 2 (setup\-\_\-case; make\-\_\-rocoto) several times, until rocoto xmls and the config files from legacy and C\-R\-O\-W based configuration system match each other. Generate a benchmark case (typically located under /case/ and named $\ast$$\ast$$\ast$\-\_\-baseline.yaml), which includes all core jobs and features typical complexities of settings as the operational workflow, using C\-R\-O\-W configuration system. And run it on operational platform (W\-C\-O\-S\-S) Workout customized workflow from modifying the variables in the benchmark case.

These steps will help users to get used to the new configuration system in a gradual approach.

\section*{Future Plans }

Develop a case generator toolbox with G\-U\-I for easier generation of a case file. Provide “group-\/level” default for all groups of the case file. Include a set of “stub” J-\/\-J\-O\-Bs to enable workflow level regression test without actually running the jobs. Develop “non-\/stop” option which user could generate workflow directly. Appendix Variable List

User Definition \mbox{[}user.\-yaml\mbox{]}

User\-\_\-places \mbox{[} P\-R\-O\-J\-E\-C\-T\-\_\-\-D\-I\-R, H\-O\-M\-Egfs, H\-O\-M\-Ecrow, N\-W\-P\-R\-O\-D, D\-M\-P\-D\-I\-R, R\-T\-M\-F\-I\-X, E\-X\-P\-D\-I\-R, R\-O\-T\-D\-I\-R, I\-C\-S\-D\-I\-R, C\-O\-M\-R\-O\-O\-T, S\-H\-O\-R\-T\-\_\-\-T\-E\-R\-M\-\_\-\-T\-E\-M\-P, L\-O\-N\-G\-\_\-\-T\-E\-R\-M\-\_\-\-T\-E\-M\-P, H\-O\-M\-E\-D\-I\-R, N\-O\-S\-C\-R\-U\-B, F\-I\-Xgsi, H\-O\-M\-Efv3gfs, H\-O\-M\-Epost, H\-O\-M\-Eobsproc\-\_\-prep, H\-O\-M\-Eobsproc\-\_\-network, B\-A\-S\-E\-\_\-\-V\-E\-R\-I\-F, B\-A\-S\-E\-\_\-\-S\-V\-N, B\-A\-S\-E\-\_\-\-G\-I\-T, ics\-\_\-from, parexp, H\-P\-S\-S\-\_\-\-P\-A\-R\-\_\-\-P\-A\-T\-H\mbox{]}

accounting \mbox{[} cpu\-\_\-project, hpss\-\_\-project, noscrub\-\_\-project, ecflow\-\_\-machine, ecflow\-\_\-header, shared\-\_\-partition, exclusive\-\_\-partition, service\-\_\-partition \mbox{]}

Experiment \mbox{[}case.\-yaml\mbox{]}

settings, \mbox{[}dev\-\_\-safeguards(\-True), realtime(\-False), run\-\_\-vrfy\-\_\-jobs(\-True), four\-\_\-cycle\-\_\-mode(\-False), rocoto\-\_\-cycle\-\_\-throttle(2), rocoto\-\_\-task\-\_\-throttle(5), use\-\_\-nco\-\_\-ecflow\-\_\-headers(=four\-\_\-cycle\-\_\-mode), prod\-\_\-util\-\_\-module, ecflow\-\_\-module, ecflow\-\_\-real\-\_\-clock, ecflow\-\_\-virtual\-\_\-clock, ecflow\-\_\-hybrid\-\_\-clock, ecflow\-\_\-totality\-\_\-limit, run\-\_\-gsi, run\-\_\-enkf, chgres\-\_\-and\-\_\-convert\-\_\-ics, max\-\_\-job\-\_\-tries, I\-C\-\_\-\-C\-D\-U\-M\-P, gfs\-\_\-cyc, S\-D\-A\-T\-E, E\-D\-A\-T\-E, ics\-\_\-from\mbox{]}

fv3\-\_\-settings/fv3\-\_\-gfs\-\_\-settings/fv3\-\_\-enkf\-\_\-settings/fv3\-\_\-gdas\-\_\-settings \mbox{[}imp\-\_\-physics, new\-\_\-o3force, h2o\-\_\-phys, do\-\_\-vort\-\_\-damp, consv\-\_\-te, fv\-\_\-sg\-\_\-adj, dspheat, shal\-\_\-cnv, agrid\-\_\-vel\-\_\-rst, cal\-\_\-pre, do\-\_\-sat\-\_\-adjust, random\-\_\-clds, cnvcld, dnats, I\-E\-M\-S, I\-A\-L\-B, I\-S\-O\-L, I\-A\-E\-R, I\-C\-O2, warm\-\_\-start, read\-\_\-increment, restart\-\_\-interval, L\-E\-V\-S, F\-H\-C\-Y\-C, F\-H\-C\-Y\-C\-\_\-\-G\-D\-A\-S, F\-H\-C\-Y\-C\-\_\-\-G\-F\-S, Q\-U\-I\-L\-T\-I\-N\-G, W\-R\-I\-T\-E\-\_\-\-N\-E\-M\-S\-I\-O\-F\-I\-L\-E, W\-R\-I\-T\-E\-\_\-\-N\-E\-M\-S\-I\-O\-F\-L\-I\-P, nst\-\_\-anl, lprecip\-\_\-accu, D\-O\-N\-S\-T, M\-O\-N\-O, M\-E\-M\-B\-E\-R, d4\-\_\-bg, dddmp, I\-S\-E\-E\-D, S\-E\-T\-\_\-\-S\-T\-P\-\_\-\-S\-E\-E\-D, D\-O\-\_\-\-S\-H\-U\-M, D\-O\-\_\-\-S\-K\-E\-B, D\-O\-\_\-\-S\-P\-P\-T, R\-U\-N\-\_\-\-E\-F\-C\-S\-G\-R\-P, ncld, nwat, zhao\-\_\-mic, nh\-\_\-type, U\-S\-E\-\_\-\-C\-O\-U\-P\-L\-E\-R\-\_\-\-R\-E\-S, cdmbgwd, C\-D\-U\-M\-P, C\-A\-S\-E\mbox{]}

schedvar \mbox{[}cpu\-\_\-project, shared\-\_\-queue, service\-\_\-queue, exclusive\-\_\-queue, partition, shared\-\_\-partition, service\-\_\-partition, exclusive\-\_\-partition, script\-\_\-home, obsproc\-\_\-network\-\_\-home, obsproc\-\_\-prep\-\_\-home\mbox{]}

gfs\-\_\-output\-\_\-settings \mbox{[}F\-H\-O\-U\-T\-\_\-\-G\-F\-S, F\-H\-M\-I\-N\-\_\-\-G\-F\-S, F\-H\-M\-I\-N\-\_\-\-E\-N\-K\-F, F\-H\-M\-A\-X\-\_\-\-E\-N\-K\-F, F\-H\-O\-U\-T\-\_\-\-E\-N\-K\-F, F\-H\-M\-I\-N\-\_\-\-G\-D\-A\-S, F\-H\-M\-A\-X\-\_\-\-G\-D\-A\-S, F\-H\-O\-U\-T\-\_\-\-G\-D\-A\-S, F\-H\-M\-A\-X\-\_\-\-H\-F\-\_\-\-G\-F\-S, F\-H\-O\-U\-T\-\_\-\-H\-F\-\_\-\-G\-F\-S, N\-C\-O\-\_\-\-N\-A\-M\-I\-N\-G\-\_\-\-C\-O\-N\-V, O\-U\-T\-P\-U\-T\-\_\-\-F\-I\-L\-E\-\_\-\-T\-Y\-P\-E, gfs\-\_\-forecast\-\_\-hours, gdas\-\_\-forecast\-\_\-hours, enkf\-\_\-epos\-\_\-fhr, wafs\-\_\-last\-\_\-hour, awips\-\_\-g2\-\_\-hours, awips\-\_\-20km\-\_\-1p0\-\_\-hours\mbox{]}

data\-\_\-assimilation \mbox{[}D\-O\-H\-Y\-B\-V\-A\-R, N\-M\-E\-M\-\_\-\-E\-N\-K\-F, N\-M\-E\-M\-\_\-\-E\-O\-M\-G\-G\-R\-P, N\-M\-E\-M\-\_\-\-E\-F\-C\-S\-G\-R\-P, N\-M\-E\-M\-\_\-\-E\-A\-R\-C\-G\-R\-P, R\-E\-C\-E\-N\-T\-E\-R\-\_\-\-E\-N\-K\-F, S\-M\-O\-O\-T\-H\-\_\-\-E\-N\-K\-F, assim\-\_\-freq, l4densvar, lwrite4danl, N\-S\-P\-L\-I\-T, N\-A\-M\-\_\-\-E\-N\-K\-F, I\-N\-C\-R\-E\-M\-E\-N\-T\-S\-\_\-\-T\-O\-\_\-\-Z\-E\-R\-O, P\-R\-E\-P\-\_\-\-R\-E\-A\-L\-T\-I\-M\-E, D\-O\-\_\-\-E\-M\-C\-S\-F\-C, P\-R\-O\-C\-E\-S\-S\-\_\-\-T\-R\-O\-P\-C\-Y, D\-O\-\_\-\-R\-E\-L\-O\-C\-A\-T\-E, D\-O\-\_\-\-M\-A\-K\-E\-P\-R\-E\-P\-B\-U\-F\-R, O\-P\-R\-E\-F\-I\-X, C\-O\-M\-\_\-\-O\-B\-S, C\-O\-M\-I\-N\-\_\-\-O\-B\-S, R\-E\-R\-U\-N\-\_\-\-E\-F\-C\-S\-G\-R\-P, R\-E\-R\-U\-N\-\_\-\-E\-O\-M\-G\-G\-R\-P, G\-E\-N\-D\-I\-A\-G, N\-E\-P\-O\-S\-G\-R\-P, O\-B\-S\-I\-N\-P\-U\-T\-\_\-\-I\-N\-V\-O\-B\-S, O\-B\-S\-Q\-C\-\_\-\-I\-N\-V\-O\-B\-S, E\-N\-K\-F\-\_\-\-I\-N\-N\-O\-V\-A\-T\-E\-\_\-\-G\-R\-O\-U\-P\-S, E\-N\-K\-F\-\_\-\-F\-O\-R\-E\-C\-A\-S\-T\-\_\-\-G\-R\-O\-U\-P\-S, E\-N\-K\-F\-\_\-\-A\-R\-C\-H\-I\-V\-E\-\_\-\-G\-R\-O\-U\-P\-S\mbox{]}

post \mbox{[}G\-O\-E\-S\-F, G\-T\-G\-F, F\-L\-X\-F, P\-G\-B1\-F, G\-F\-S\-\_\-\-D\-O\-W\-N\-S\-T\-R\-E\-A\-M, downset, N\-P\-O\-S\-T\-G\-R\-P, master\-\_\-grid\mbox{]}

downstream \mbox{[}V\-D\-U\-M\-P, C\-D\-U\-M\-P\-F\-C\-S\-T, C\-D\-F\-N\-L, M\-K\-P\-G\-B4\-P\-R\-C\-P, V\-R\-F\-Y\-F\-I\-T\-S, V\-S\-D\-B\-\_\-\-S\-T\-E\-P1, V\-S\-D\-B\-\_\-\-S\-T\-E\-P2, V\-R\-F\-Y\-G2\-O\-B\-S, V\-R\-F\-Y\-P\-R\-C\-P, V\-R\-F\-Y\-R\-A\-D, V\-R\-F\-Y\-O\-Z\-N, V\-R\-F\-Y\-M\-I\-N\-M\-O\-N, V\-R\-F\-Y\-T\-R\-A\-K, V\-R\-F\-Y\-G\-E\-N\-E\-S\-I\-S, R\-U\-N\-M\-O\-S, D\-O\-\_\-\-P\-O\-S\-T\-\_\-\-P\-R\-O\-C\-E\-S\-S\-I\-N\-G, D\-O\-\_\-\-B\-U\-F\-R\-S\-N\-D, D\-O\-\_\-\-G\-E\-M\-P\-A\-K, D\-O\-\_\-\-A\-W\-I\-P\-S, D\-O\-\_\-\-F\-A\-X, D\-O\-\_\-\-W\-A\-F\-S, D\-O\-\_\-\-B\-U\-L\-L\-E\-T\-I\-N\-S, F\-H\-O\-U\-T\-\_\-\-C\-Y\-C\-L\-O\-N\-E\-\_\-\-G\-F\-S, F\-H\-O\-U\-T\-\_\-\-C\-Y\-C\-L\-O\-N\-E\-\_\-\-G\-D\-A\-S\mbox{]}

places, same as user\-\_\-places.

nsst, \mbox{[} N\-S\-T\-\_\-\-M\-O\-D\-E\-L, N\-S\-T\-\_\-\-R\-E\-S\-V, Z\-S\-E\-A1, Z\-S\-E\-A2, N\-S\-T\-\_\-\-G\-S\-I, N\-S\-T\-I\-N\-F\-O, N\-S\-T\-\_\-\-S\-P\-I\-N\-U\-P\mbox{]}

archiving \mbox{[} archive\-\_\-to\-\_\-hpss, arch\-\_\-cyc, arch\-\_\-warmicfreq, arch\-\_\-fcsticfreq, copy\-\_\-fit2obs\-\_\-files, scrub\-\_\-in\-\_\-archive, scrub\-\_\-in\-\_\-archive\-\_\-start, scrub\-\_\-in\-\_\-archive\-\_\-end, A\-T\-A\-R\-D\-I\-R \mbox{]}

\section*{F\-A\-Q }

Q\-: Which part of my work will be affected by starting to use C\-R\-O\-W? A\-: Only those before a Rocoto xml is generated.

Q\-: Do I need to be an expert of Python or Y\-A\-M\-L? A\-: No. general users may not need to know python programming at all.

Q\-: Do I have to run C\-R\-O\-W on a supercomputer? A\-: C\-R\-O\-W itself doesn’t require a supercomputer. However, The global-\/workflow does require a supercomputer to run.

Q\-: What happens when there are multiple partitions available on a supercomputer? A\-: You will have to specify the one you want by invoking the -\/p \mbox{[}platform\mbox{]} option, or it will stop.

Q\-: Can I manually edit configs in the experiment directory between the two steps? A\-: No. You will need to edit the case file and start over from the first step. It will re-\/create the experiment directory while not affecting the experiment case that is currently running.

Q\-: Why not to overwrite platform file by default when user calls -\/f during setup\-\_\-case? A\-: The platform file is validated differently from other configuration files. Usually selection of long-\/term and short-\/term storage places is decided in this step by functions like “mmlsquota”, which returns the most empty partitions from a list of places (ie, /ptmp1, /ptmp2..). If the experiment case is already running, then overwriting the platform file could result in a different partition to be set as long-\/term or short-\/term storage other than the existing one. Obviously this is not anticipated. So a “-\/\-F” option was designed especially for those who want to overwrite the platform file.

Q\-: Why put all configs in the experiment directory at all if users are not recommended to edit them? A\-: They mainly serve as “checkpoints” and documentation for your experiment settings. Along with the need to make the transition easier for users of legacy configuration system. A “non-\/stop” option will be included in the future releases within which user will be able to generate the desired workflow in only one step.

Q\-: Will C\-R\-O\-W increase the runtime overhead of my workflow? A\-: No. C\-R\-O\-W doesn’t Once the workflow has been generated, it will run the same way as was generated in any other methods.

Q\-: Why reading all Y\-A\-M\-L at once every time even if I am doing really tiny changes? A\-: Consistency. In a system as large and complex as the Global Workflow, inconsistency of cross-\/job arguments such as accounts, time or dependencies could take significant number of working hours from both human and supercomputers to fix. Among them, inconsistency results from accidental error of manual editing plays a big part. In other words, your “tiny” changes may affect the entire workflow, and our design helps make sure it is done correctly. For this reason, “patch editing” is neither implemented nor recommended.

\section*{Common Errors }

Missing/conflicting python in environment

Message\-: \mbox{[}Joe.\-Schmo\mbox{]}\$ ./setup\-\_\-case.sh tutorial\-\_\-case test Lmod has detected the following error\-: Cannot load module \char`\"{}intelpython/3.\-6.\-1.\-0\char`\"{} because these module(s) are loaded\-: Python While processing the following module(s)\-: Module fullname Module Filename 

 intelpython/3.\-6.\-1.\-0 /apps/modules/modulefiles/intelpython/3.6.\-1.\-0 Cause\-: A conflicting python module is loaded. May also get python error if you are missing python in your environment (module or P\-A\-T\-H). Fix\-: Unload conflicting python module and/or load a python module or add python to your P\-A\-T\-H \begin{DoxyVerb}[Joe.Schmo@tfe07 ecfutils]$ module unload python
\end{DoxyVerb}
 Missing C\-R\-O\-W submodule

Message\-: \mbox{[}Joe.\-Schmo ecfutils\mbox{]}\$ ./setup\-\_\-case.sh tutorial\-\_\-case test Traceback (most recent call last)\-: File \char`\"{}$<$string$>$\char`\"{}, line 3, in $<$module$>$ File \char`\"{}/scratch4/\-N\-C\-E\-P\-D\-E\-V/global/save/\-Joe.\-Schmo/git/global-\/workflow/workflow/worktools.\-py\char`\"{}, line 34, in $<$module$>$ import crow.\-tools, crow.\-config Module\-Not\-Found\-Error\-: No module named 'crow' Cause\-: forgot to checkout C\-R\-O\-W sub-\/module Cause\-: You forgot to obtain the C\-R\-O\-W submodule in your clone by running ‘git submodule’. Fix\-: Run submodule command at the top of global-\/workflow clone \begin{DoxyVerb}> git submodule update --init -recursive
\end{DoxyVerb}
 Missing user file

Message\-: \mbox{[}Joe.\-Schmo ecfutils\mbox{]}\$ ./setup\-\_\-case.sh tutorial\-\_\-case test E\-R\-R\-O\-R\-:crow.\-model.\-fv3gfs\-:You did not create user.\-yaml! E\-R\-R\-O\-R\-:crow.\-model.\-fv3gfs\-:Copy user.\-yaml.\-default to user.\-yaml and edit. Cause\-: You forgot to create your user.\-yaml file, silly goose! Fix\-: Create your user.\-yaml. Under /workflow copy user.\-yaml.\-default to user.\-yaml and modify as needed to fit your account. Experiment directory already exists

Message\-: \mbox{[}Joe.\-Schmo ecfutils\mbox{]}\$ ./setup\-\_\-case.sh tutorial\-\_\-case test W\-A\-R\-N\-I\-N\-G\-:crow.\-model.\-fv3gfs\-:/scratch4/\-N\-C\-E\-P\-D\-E\-V/global/noscrub/\-Joe.Schmo/expdir/test\-: already exists! E\-R\-R\-O\-R\-:crow.\-model.\-fv3gfs\-:Target directories already exist. E\-R\-R\-O\-R\-:crow.\-model.\-fv3gfs\-:I will not start a workflow unless you do -\/f. C\-R\-I\-T\-I\-C\-A\-L\-:crow.\-model.\-fv3gfs\-:Use -\/f to force this workflow to start, but we aware that config, initial C\-O\-M, and yaml files will be overwritten. Other files will remain unmodified. Cause\-: Your experiment directory already exists so the script does not want to delete and remake it without warning you. Fix\-: Either remove the directory or use the ‘-\/f’ or ‘-\/\-F’ flags when running setup\-\_\-case.\-sh to override the warning message and proceed with remaking experiment directory. C\-O\-M directory already exists

Message\-: S\-U\-R\-G\-E-\/slogin1 $>$ ./setup\-\_\-case.sh tutorial\-\_\-case test W\-A\-R\-N\-I\-N\-G\-:crow.\-model.\-fv3gfs\-:/gpfs/hps3/ptmp/\-Joe.Schmo/comrot/test\-: already exists! E\-R\-R\-O\-R\-:crow.\-model.\-fv3gfs\-:Target directories already exist. E\-R\-R\-O\-R\-:crow.\-model.\-fv3gfs\-:I will not start a workflow unless you do -\/f. C\-R\-I\-T\-I\-C\-A\-L\-:crow.\-model.\-fv3gfs\-:Use -\/f to force this workflow to start, but we aware that config, initial C\-O\-M, and yaml files will be overwritten. Other files will remain unmodified. Cause\-: Your C\-O\-M directory already exists so the script does not want to delete and remake it without warning you. Fix\-: Either remove the directory or use the ‘-\/f’ flag when running setup\-\_\-case.\-sh to override the warning message and proceed with remaking comrot. Warning about missing initial condition files

Message\-: Copy input conditions from\-: /gpfs/hps3/emc/global/noscrub/emc.glopara/\-I\-C\-S Copy input conditions to\-: /gpfs/hps3/ptmp/\-Joe.Schmo/comrot/test W\-A\-R\-N\-I\-N\-G\-:crow.\-model.\-fv3gfs\-:/gpfs/hps3/emc/global/noscrub/emc.glopara/\-I\-C\-S/2018060400/\-C384/mem001/\-I\-N\-P\-U\-T\-: link target does not exist … W\-A\-R\-N\-I\-N\-G\-:crow.\-model.\-fv3gfs\-:/gpfs/hps3/emc/global/noscrub/emc.glopara/\-I\-C\-S/2018060400/\-C384/mem080/\-I\-N\-P\-U\-T\-: link target does not exist W\-A\-R\-N\-I\-N\-G\-:crow.\-model.\-fv3gfs\-:/gpfs/hps3/emc/global/noscrub/emc.glopara/\-I\-C\-S/2018060400/gdas/\-C768/\-I\-N\-P\-U\-T\-: link target does not exist W\-A\-R\-N\-I\-N\-G\-:crow.\-model.\-fv3gfs\-:/gpfs/hps3/emc/global/noscrub/emc.glopara/\-I\-C\-S/2018060400/gdas.\-t00z.\-abias\-: link target does not exist W\-A\-R\-N\-I\-N\-G\-:crow.\-model.\-fv3gfs\-:/gpfs/hps3/emc/global/noscrub/emc.glopara/\-I\-C\-S/2018060400/gdas.\-t00z.\-abias\-\_\-pc\-: link target does not exist W\-A\-R\-N\-I\-N\-G\-:crow.\-model.\-fv3gfs\-:/gpfs/hps3/emc/global/noscrub/emc.glopara/\-I\-C\-S/2018060400/gdas.\-t00z.\-abias\-\_\-air\-: link target does not exist W\-A\-R\-N\-I\-N\-G\-:crow.\-model.\-fv3gfs\-:/gpfs/hps3/emc/global/noscrub/emc.glopara/\-I\-C\-S/2018060400/gdas.\-t00z.\-radstat\-: link target does not exist Cause\-: The script expects to find the I\-Cs on disk to link to but they are missing. Fix\-: a) Can ignore if you plan to move your own I\-Cs into your C\-O\-M directory or b) can rerun setup\-\_\-case.\-sh with ‘-\/c’ flag to not create C\-O\-M directory or attempt to make links or c) if I\-Cs should be there resolve missing files and rerun script Missing P\-R\-O\-J\-E\-C\-T\-\_\-\-D\-I\-R setting in user file

Message\-: S\-U\-R\-G\-E-\/slogin1 $>$ ./setup\-\_\-case.sh -\/f tutorial\-\_\-case test Traceback (most recent call last)\-: File \char`\"{}/scratch4/\-N\-C\-E\-P\-D\-E\-V/global/save/\-Joe.\-Schmo/global-\/workflow/workflow/\-C\-R\-O\-W/crow/config/eval\-\_\-tools.\-py\char`\"{}, line 106, in from\-\_\-config result=val.\-\_\-result(globals,locals) File \char`\"{}/scratch4/\-N\-C\-E\-P\-D\-E\-V/global/save/\-Joe.\-Schmo/global-\/workflow/workflow/\-C\-R\-O\-W/crow/config/eval\-\_\-tools.\-py\char`\"{}, line 49, in \-\_\-result raise Config\-User\-Error(eval(\char`\"{}f'''\char`\"{}+self+\char`\"{}'''\char`\"{},c,locals)) crow.\-config.\-exceptions.\-Config\-User\-Error\-: Please select a project directory. Cause\-: You forgot to set P\-R\-O\-J\-E\-C\-T\-\_\-\-D\-I\-R in your user.\-yaml. Fix\-: Set P\-R\-O\-J\-E\-C\-T\-\_\-\-D\-I\-R in your user.\-yaml and try again. 