

post: &post_action !Action
  <<: *action_template
  J_JOB: post
  walltime: !timedelta 00:15:00
#  resources: !calc run_post
  resources: !calc run_test.resources
  memory: "3072M"
  APRUN_DWN: "'mpirun -np 72'"
  APRUN_NP: "'mpirun -np 72'"
  CASE_ENKF: !calc doc.fv3_enkf_settings.CASE
  CNVGRIB: !calc doc.places.CNVGRIB
  COPYGB: !calc doc.places.COPYGB
  COPYGB2: !calc doc.places.COPYGB2
  DMPDIR: !calc doc.places.DMPDIR
  DOHYBVAR: !calc doc.case.DOHYBVAR
  DO_GDAS_FCST_POST: YES
  EDATE: !calc doc.case.EDATE
  FCSTEXEC: "fv3_gfs_nh.prod.32bit.x"
  FORECASTSH: !expand "{doc.places.BASE_GSM}/scripts/exglobal_fcst_nemsfv3gfs.sh"
  FCSTEXECDIR: !expand "{doc.places.BASE_NEMSfv3gfs}/NEMS/exe"
  FCSTEXEC: "fv3_gfs_nh.prod.32bit.x"
  FLXF: YES
  GFSDOWNSH: !expand "{doc.places.BASE_GSM}/ush/fv3gfs_downstream_nems.sh"
  GFSDWNSH: !expand "{doc.places.BASE_GSM}/ush/fv3gfs_dwn_nems.sh"
  GFS_DOWNSTREAM: YES
  GOESF: NO
  GPOST: YES
  GRB2INDEX: "/scratch4/NCEPDEV/global/save/glopara/nwpara/util/exec/grb2index"
  GRBINDEX: "/scratch4/NCEPDEV/global/save/glopara/nwpara/util/exec/grbindex"
  GRBINDEX2: "/scratch4/NCEPDEV/global/save/glopara/nwpara/util/exec/grb2index"  
  GTGF: NO
  HOMEDIR: !calc doc.places.HOMEDIR
  KEEPDATA: NO
  LEVS: !calc doc.fv3_settings.LEVS
  MPI_BUFS_PER_HOST: !calc doc.platform.MPI_BUFS_PER_HOST
  MPI_BUFS_PER_PROC: !calc doc.platform.MPI_BUFS_PER_PROC
  MPI_GROUP_MAX: !calc doc.platform.MPI_GROUP_MAX
  MPI_MEMMAP_OFF: !calc doc.platform.MPI_MEMMAP_OFF
  MP_STDOUTMODE: !calc doc.platform.MP_STDOUTMODE
  MYBASE_SVN: !calc doc.places.MYBASE_SVN
  NCO_NAMING_CONV: !calc doc.platform.NCO_NAMING_CONV
  NCP: !calc doc.platform.NCP
  NDATE: !calc doc.platform.NDATE
  NEMSIOGET: !calc doc.platform.NEMSIOGET
  NHOUR: !calc doc.platform.NHOUR
  NLN: !calc doc.platform.NLN
  NMEM_ENKF: !calc doc.data_assimilation.NMEM_ENKF
  NMV: !calc doc.platform.NMV
  NOSCRUB: !calc doc.case.NOSCRUB
  NTHREADS_DWN: 2
  NTHREADS_NP: 1
  NTHSTACK: 1024000000
  NWPROD: !calc doc.platform.NWPROD
  OMP_STACKSIZE: !calc doc.platform.OMP_STACKSIZE
  OUTPUT_GRID: "gaussian_grid"
  POSTJJOBSH: !expand "{doc.places.BASE_WORKFLOW}/jobs/JGFS_POST.sh"
  POSTGPSH: !expand "{doc.places.BASE_POST}/ush/global_nceppost.sh"
  POSTGRB2TBL: !calc doc.places.POSTGRB2TBL
  POSTGPEXEC: !expand "{doc.places.BASE_POST}/exec/ncep_post"
  PSLOT: !calc doc.places.PSLOT
  QUILTING: YES
  REALTIME: !calc doc.case.REALTIME
  RECENTER_ENKF: !calc doc.case.RECENTER_ENKF
  ROTDIR: !calc doc.case.rundir
  npe_post: !calc resources[0].mpi_ranks
  npe_postgp: !calc npe_post
  nth_postgp: 1
  GFS_DOWNSTREAM: "YES"
  GFSDOWNSH: !expand "{doc.places.BASE_WORKFLOW}/ush/fv3gfs_downstream_nems.sh"
  GFSDWNSH: !expand "{doc.places.BASE_WORKFLOW}/ush/fv3gfs_dwn_nems.sh"
  downset: 1
  npe_dwn: !calc npe_post
  nth_dwn: 2
  nth_post: 2

arch: &arch_action !Action
  <<: *action_template
  J_JOB: arch
  walltime: !timedelta 06:00:00
  resources: !calc run_arch.resources
  memory: "3072M"
  accounting: !calc doc.platform.transfer_accounting

vrfy: &vrfy_action !Action
  <<: [ *case, *action_template ]
  J_JOB: vrfy
  Template:
    <<: [ *vrfy_template, *fv3_resolution ]
  walltime: !timedelta 01:00:00
  resources: !calc run_vrfy.resources
  memory: "3072M"
  accounting: !calc doc.platform.parallel_accounting
#  CDUMP: "gfs"
  CASE_ENKF: !calc doc.fv3_enkf_settings.CASE
  CDFNL: "gdas"
  CDUMPFCST: "gdas"  # Fit-to-obs with GDAS/GFS prepbufr
  CNVGRIB: !calc doc.places.CNVGRIB
  COPYGB: !calc doc.places.COPYGB
  COPYGB2: !calc doc.places.COPYGB2
  DOHYBVAR: !calc doc.case.DOHYBVAR
  GRB2INDEX: !calc doc.platform.GRB2INDEX
  GRBINDEX: !calc doc.platform.GRBINDEX
  GRBINDEX2: !calc doc.platform.GRBINDEX2
  GRIB1_WORKS: NO
  HOMEDIR: !calc doc.case.HOMEDIR
  LEVS: !calc doc.fv3_settings.LEVS
  KEEPDATA: NO
  MPI_BUFS_PER_HOST: !calc doc.platform.MPI_BUFS_PER_HOST
  MPI_BUFS_PER_PROC: !calc doc.platform.MPI_BUFS_PER_PROC
  MPI_GROUP_MAX: !calc doc.platform.MPI_GROUP_MAX
  MPI_MEMMAP_OFF: !calc doc.platform.MPI_MEMMAP_OFF
  MP_STDOUTMODE: !calc doc.platform.MP_STDOUTMODE
  NCO_NAMING_CONV: !calc doc.platform.NCO_NAMING_CONV
  NCP: !calc doc.platform.NCP
  NLN: !calc doc.platform.NLN
  NMEM_ENKF: !calc doc.data_assimilation.NMEM_ENKF
  NMV: !calc doc.platform.NMV
  NOSCRUB: !calc doc.case.NOSCRUB
  NTHSTACK: 1024000000
  OMP_STACKSIZE: !calc doc.platform.OMP_STACKSIZE
  OUTPUT_GRID: "gaussian_grid"
  POSTJJOBSH: !expand "{doc.places.BASE_WORKFLOW}/jobs/JGFS_POST.sh"
  PSLOT: !calc doc.places.PSLOT
  PTMP: !calc doc.places.PTMP
  QUILTING: YES
  REALTIME: !calc doc.case.REALTIME
  RECENTER_ENKF: !calc doc.case.RECENTER_ENKF
  ROTDIR: !calc doc.places.ROTDIR
  RUNDIR: !calc doc.places.RUNDIR
  SDATE: !calc doc.case.SDATE
  SMOOTH_ENKF: YES
  STMP: !calc doc.places.STMP
  VRFYGENESIS: YES     # Cyclone genesis
  VRFYGMPK: NO         # Gempak verification
  WRITE_NEMSIOFILE: YES
  assim_freq: 6
  memory_vrfy: "16384M"
  nst_anl: YES
  WRITE_NEMSIOFILE: YES
