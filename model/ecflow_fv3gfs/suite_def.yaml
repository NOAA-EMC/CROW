wcoss_cray_scheduler_settings:
  name: LSFAlps
  physical_cores_per_node: 24
  logical_cpus_per_core: 2
  hyperthreading_allowed: true

theia_scheduler_settings:
  name: MoabTorque
  physical_cores_per_node: 24
  logical_cpus_per_core: 2
  hyperthreading_allowed: true
  
scheduler_settings: !calc wcoss_cray_scheduler_settings

scheduler: !calc |
  tools.get_scheduler(doc.scheduler_settings.name,
                      doc.scheduler_settings)

shared_accounting: &shared_accounting
  queue: !calc metasched.varref('QUEUESERV')
  project: !calc metasched.varref('PROJECT')

exclusive_accounting: &exclusive_accounting
  queue: !calc metasched.varref('QUEUE')
  project: !calc metasched.varref('PROJECT')

shared_task_template: &shared_task_template
  <<: *ecf_file_logic
  accounting: *shared_accounting
  J_JOB: !calc tools.to_upper(task_path_var[-1])
  Rocoto: *rocoto_task_template

exclusive_task_template: &exclusive_task_template
  <<: *ecf_file_logic
  accounting: *exclusive_accounting
  J_JOB: !calc tools.to_upper(task_path_list[-1])
  Rocoto: *rocoto_task_template

suite: !Cycle
  Clock: !Clock
    start: 2018-01-01T00:00:00
    end: 2018-01-01T18:00:00
    step: !timedelta "6:00:00"

  ecFlow:
    suite_def_filename: "prod%H.def"
    suite_name: "prod%H"
    scheduler: !calc doc.scheduler

  Rocoto: *Rocoto

  ecflow_def: !expand |
    repeat day 1
    edit ECF_TRIES '1'
    #edit ECF_JOB_CMD 'lsub %ECF_JOB% %ECF_JOBOUT% xc40-dev'
    edit ECF_JOB_CMD 'lsub %ECF_JOB% %ECF_JOBOUT% %MACHINE%'
    edit ECF_KILL_CMD 'lkill %ECF_NAME% %ECF_JOBOUT%'
    edit ECF_HOME '{doc.settings.ECF_HOME}'
    #edit ECF_HOME '/gpfs/hps3/emc/global/noscrub/emc.glopara/ecflow/fv3'
    edit CYC '{tools.strftime(suite.Clock.now,"%H")}'
    edit ENVIR 'prod'
    edit PROJ '{doc.settings.PROJECT}'
    edit E 'jecffv3'
    #edit QUEUE 'dev'
    edit QUEUE '{doc.settings.QUEUE}'
    edit PROJENVIR '{doc.settings.PROJECT}'
    #edit EMCPEN 'ecfgfsfv3'
    edit EMCPEN '{doc.settings.experiment_name}'
    #edit COM '/gpfs/hps2/ptmp/emc.glopara/%EMCPEN%/com'
    edit COM '{doc.settings.COM}'
    edit QUEUESERV '{doc.settings.QUEUESERV}'
    edit DATAROOT '{doc.settings.DATAROOT}'
    edit ECF_FILES '{doc.settings.ECF_HOME}/scripts'
    edit ECF_OUT '{doc.settings.ECF_HOME}/output'
    edit ECF_LOG '{doc.settings.ECF_HOME}/ecf.log'
    edit MODEL_NAME 'gfs'

  gfs: !Family
    ecflow_def: !expand |
      edit ECF_JOB_CMD 'lsub %ECF_JOB% %ECF_JOBOUT% xc40-dev'
      edit ECF_FILES '{doc.settings.ECF_HOME}/scripts'
      edit PROJ '%PROJENVIR%'
      edit MODEL_NAME 'gfs'

    dump: !Family
      jgfs_tropcy_qc_reloc: !Task
        <<: *exclusive_task_template
        Trigger: !Depend jgfs_dump
        jtwc_bull_email: !DataEvent {file="/dev/null"}
        resources: !calc ( doc.resource_demo.run_nothing )

      #Replaced by emc version of dump job 
      #This dump job should be using NCO version when delivery to NCO
      jgfs_dump: !Task
        <<: *exclusive_task_template
        release_sfcprep: !DataEvent {file="/dev/null"}
        #Time: !timedelta +3:50:00
        resources: !calc ( doc.resource_demo.run_nothing )

    prep: !Family
      jgfs_emcsfc_sfc_prep: !Task
        <<: *exclusive_task_template
        Trigger: !Depend up.dump.jgfs_dump.release_sfcprep
        resources: !calc ( doc.resource_demo.run_nothing )
    
      jgfs_prep: !Task
        <<: *exclusive_task_template
        Trigger: !Depend up.dump
        #Trigger: !Depend ( up.dump.jgfs_dump & up.dump.jgfs_tropcy_qc_reloc
        resources: !calc ( doc.resource_demo.run_prep )

      jgfs_prep_post: !Task
        <<: *exclusive_task_template
        Trigger: !Depend  up.jgfs_analysis
        resources: !calc ( doc.resource_demo.run_nothing )

    jgfs_analysis: !Task
      <<: *exclusive_task_template
      #Trigger: !Depend ( prep.jgfs_prep & prep.jgfs_emcsfc_sfc_prep  & up.gdas.enkf.jgdas_enkf_post.at('-6:00:00') )
      Trigger: !Depend ( prep.jgfs_prep & prep.jgfs_emcsfc_sfc_prep )
      resources: !calc ( doc.resource_demo.run_anal )

    jgfs_vminmon: !Task
      <<: *exclusive_task_template
      Trigger: !Depend jgfs_analysis
      resources: !calc ( doc.resource_demo.run_nothing )

    forecast: !Family
      jgfs_forecast_high: !Task
        <<: *exclusive_task_template
        Trigger: !Depend up.jgfs_analysis
        resources: !calc ( doc.resource_demo.run_gfsfcst )
        J_JOB: JGLOBAL_FORECAST

      jgfs_forecast_low: !Task
        <<: *exclusive_task_template
        Trigger: !Depend jgfs_forecast_high
        resources: !calc ( doc.resource_demo.run_gfsfcst )
        J_JOB: JGLOBAL_FORECAST

    sminit_guam: !Family
      jgfs_sminit_guam_even: !Task
        <<: *exclusive_task_template
        Trigger: !Depend ( up.post.jgfs_post_anl.is_running() | up.post.jgfs_post_anl )
        resources: !calc ( doc.resource_demo.run_nothing )

      jgfs_sminit_guam_odd: !Task
        <<: *exclusive_task_template
        Trigger: !Depend ( up.post.jgfs_post_anl.is_running() | up.post.jgfs_post_anl )
        resources: !calc ( doc.resource_demo.run_nothing )

    post_processing: !Family
      #This is a dummy task as a placeholder
      dummy: !Task
        <<: *exclusive_task_template
        Trigger: !Depend up.forecast
        resources: !calc ( doc.resource_demo.run_nothing )

      fax: !Family
        jgfs_fax_f00: !Task
          ecflow_def: |
            edit FCSTHR '00'
          <<: *exclusive_task_template
          Trigger: !Depend ( up.up.prdgen.jgfs_pgrb2_f00 & up.up.prdgen.jgfs_pgrb2_anl )
          resources: !calc ( doc.resource_demo.run_nothing )

        jgfs_fax_anl: !Task
          ecflow_def: |
            edit FCSTHR 'anl'
          <<: *exclusive_task_template
          Trigger: !Depend up.up.prdgen.jgfs_pgrb2_anl
          resources: !calc ( doc.resource_demo.run_nothing )

        jgfs_fax_wafs_f12: !Task
          ecflow_def: |
            edit FCSTHR '12'
          <<: *exclusive_task_template
          Trigger: !Depend up.up.prdgen.jgfs_pgrb2_f12
          resources: !calc ( doc.resource_demo.run_nothing )

        jgfs_fax_wafs_f24: !Task
          ecflow_def: |
            edit FCSTHR '24'
          <<: *exclusive_task_template
          Trigger: !Depend up.up.prdgen.jgfs_pgrb2_f24
          resources: !calc ( doc.resource_demo.run_nothing )

        jgfs_fax_wafs_f36: !Task
          ecflow_def: |
            edit FCSTHR '36'
          <<: *exclusive_task_template
          Trigger: !Depend up.up.prdgen.jgfs_pgrb2_f36
          resources: !calc ( doc.resource_demo.run_nothing )

      grib_wafs: !TaskArray
        Dimensions:
          fhr: !calc tools.seq(0,doc.settings.wafs_last_hour,6)
        jgfs_wafs: !TaskElement
          <<: *exclusive_task_template
          Name: !expand 'jgfs_wafs_f{idx.fhr:02d}'
          Trigger: !FirstTrue
            - when: !calc idx.fhr == 0
              do:   !Depend ( up.up.prdgen.jgfs_pgrb2_f00 & up.up.prdgen.jgfs_pgrb2_f120 & up.grib2_wafs.jgfs_wafs_grib2 )
            - otherwise: !Depend >-
                up.up.prdgen.depend("jgfs_pgrb2_f{N:02d}",N=[ idx.fhr ])
                & this.depend("jgfs_wafs_f{N:02d}",N=[ idx.fhr-6 ])
          resources: !calc ( doc.resource_demo.run_nothing )
          ecflow_def: !expand "edit FCSTHR '{idx.fhr:02d}'"

      bufr_sounding: !Family
        jgfs_postsnd: !Task
          <<: *exclusive_task_template
          Trigger: !Depend up.up.post.jgfs_post_manager.release_post00
          resources: !calc ( doc.resource_demo.run_nothing )

      bulletins: !Family
        jgfs_fbwind: !Task
          <<: *exclusive_task_template
          Trigger: !Depend ( up.up.post.jgfs_post_f06 & up.up.post.jgfs_post_f12 & up.up.post.jgfs_post_f24 )
          resources: !calc ( doc.resource_demo.run_nothing )

        jgfs_cyclone_tracker: !Task
          <<: *exclusive_task_template
          Trigger: !Depend >- 
                up.up.post.depend("jgfs_post_f{N:02d}",N=tools.seq(0,180,6))
                & up.up.prdgen.depend("jgfs_pgrb2_f{N:02d}",N=tools.seq(0,180,6))
          resources: !calc ( doc.resource_demo.run_nothing )

      grib2_wafs: !Family
        jgfs_wafs_grib2: !Task
          <<: *exclusive_task_template
          Trigger: !Depend up.up.prdgen.jgfs_pgrb2_f00
          resources: !calc ( doc.resource_demo.run_nothing )

        jgfs_wafs_blending: !Task
          <<: *exclusive_task_template
          Trigger: !Depend jgfs_wafs_grib2
          #Time: !timedelta +4:33:00
          resources: !calc ( doc.resource_demo.run_nothing )

      grib_awips: !TaskArray
        Dimensions:
          fhr: !calc doc.settings.forecast_hours
        # tasks every 6 hours till f240
        jgfs_awips: !TaskElement
          <<: *exclusive_task_template
          Foreach: [ fhr ]
          Name: !expand "jgfs_awips_f{idx.fhr:02d}"
          Trigger: !Depend up.up.prdgen.depend('jgfs_pgrb2_f{N:02d}',N=idx.fhr)
          resources: !calc ( doc.resource_demo.run_nothing )
          ecflow_def: !expand |
            edit FCSTHR '{idx.fhr:02d}'

      awips_1p0deg: !TaskArray
        Dimensions:
          fhr: !calc doc.settings.forecast_hours
        ecflow_def: |
          edit RES '1p0deg'
          edit RESC '1P0DEG'
          #edit ECF_FILES '/gpfs/hps3/emc/global/noscrub/emc.glopara/ecflow/fv3/scripts/gfs/post_processing/awips'
          edit ECF_FILES '{doc.settings.ECF_HOME}/scripts'

        jgfs_awips: !TaskElement
          <<: *exclusive_task_template
          Foreach: [ fhr ]
          Name: !expand "jgfs_awips_f{idx.fhr:03d}"
          Trigger: !Depend up.up.prdgen.depend('jgfs_pgrb2_f{N:02d}',N=idx.fhr)
          resources: !calc ( doc.resource_demo.run_nothing )
          ecflow_def: !expand |
            edit FCSTHR '{idx.fhr:03d}'

      awips_20km: !TaskArray
        Dimensions:
          fhr: !calc doc.settings.forecast_hours
        ecflow_def: |
          edit RES '20km'
          edit RESC '20KM'
          #edit ECF_FILES '/gpfs/hps3/emc/global/noscrub/emc.glopara/ecflow/fv3/scripts/gfs/post_processing/awips'
          edit ECF_FILES '{doc.settings.ECF_HOME}/scripts'
        # tasks every 3 hours till f084, then every 6 hours till f240
        jgfs_awips: !TaskElement
          <<: *exclusive_task_template
          Foreach: [ fhr ]
          Name: !expand "jgfs_awips_f{idx.fhr:03d}"
          Trigger: !Depend up.up.prdgen.depend('jgfs_pgrb2_f{N:02d}',N=idx.fhr)
          resources: !calc ( doc.resource_demo.run_nothing )
          ecflow_def: !expand |
            edit FCSTHR '{idx.fhr:03d}'

    post: !TaskArray
      Dimensions:
        fhr: !calc doc.settings.forecast_hours
      jgfs_post_manager_el: !TaskElement
        <<: *exclusive_task_template
        Foreach: []
        Name: jgfs_post_manager
        Trigger: !Depend ( up.jgfs_analysis & up.forecast )
        release_postanl: !DataEvent {file="/dev/null"}
        release_post_fhr: !DataEventElement
          Name: !expand "release_post{idx.fhr:02d}"
          Foreach: [ fhr ]
          file: "/dev/null"
        resources: !calc ( doc.resource_demo.run_nothing )

      jgfs_post_anl: !Task
        ecflow_def: |
          edit FHR 'anl'
          edit HR 'anl'
        <<: *exclusive_task_template
        Trigger: !Depend jgfs_post_manager.release_postanl
        release_pgrb2_anl: !DataEvent {file="/dev/null"}
        resources: !calc ( doc.resource_demo.run_nothing )

      jgfs_post_f: !TaskElement
        <<: *exclusive_task_template
        Name: !expand jgfs_post_f{idx.fhr:02d}
        ecflow_def: !expand |
          edit FHR: 'f{idx.fhr:02d}'
          edit HR: '{idx.fhr:02d}'
        Trigger: !Depend jgfs_post_manager.depend('release_post{N:02d}',N=idx.fhr)
        resources: !calc ( doc.resource_demo.run_nothing )

      jgfs_pgrb2_spec_post: !Task
        <<: *exclusive_task_template
        Trigger: !Depend ( jgfs_post_f336 & jgfs_post_f348 & jgfs_post_f360 & jgfs_post_f372 & jgfs_post_f384 )
        resources: !calc ( doc.resource_demo.run_nothing )

    prdgen: !TaskArray
      Dimensions:
        fhr: !calc doc.settings.forecast_hours

      jgfs_pgrb2_manager_el: !TaskElement
        <<: *exclusive_task_template
        Foreach: []
        Name: jgfs_pgrb2_manager
        Trigger: !Depend ( up.post )
        #release_postanl: !DataEvent {file="/dev/null"}
        ecflow_first_event_number: 2
        release_post_fhr: !DataEventElement
          Name: !expand "release_post{idx.fhr:02d}"
          Foreach: [ fhr ]
          file: "/dev/null"

      pgrb_f: !TaskElement
        <<: *exclusive_task_template
        Foreach: [ fhr ]
        Name: !expand "jgfs_pgrb2_f{idx.fhr:02d}"
        resources: !calc ( doc.resource_demo.run_gfspost )
        J_JOB: JGLOBAL_POST
        ecflow_def: !expand |
          edit FHR '{idx.fhr:02d}'
          edit HR '{idx.fhr:02d}'

      jgfs_pgrb2_anl: !Task
        <<: *exclusive_task_template
        resources: !calc ( doc.resource_demo.run_gfspost )
        J_JOB: JGLOBAL_POST
        ecflow_def: !expand |
          edit FHR 'anl'
          edit HR 'anl'

      #Need to add other tasks in this prdgen family

    #endfamily prdgen

    gempak: !Family
      jgfs_gempak_upapgif: !Task
        <<: *exclusive_task_template
        Trigger: !Depend up.dump.jgfs_dump
        resources: !calc ( doc.resource_demo.run_nothing )

      jgfs_gempak_ncdc: !Task
        <<: *exclusive_task_template
        Trigger: !Depend jgfs_gempak.is_running() | jgfs_gempak.is_completed()
        resources: !calc ( doc.resource_demo.run_nothing )

      jgfs_gempak: !Task
        <<: *exclusive_task_template
        Trigger: !Depend up.jgfs_analysis
        resources: !calc ( doc.resource_demo.run_nothing )

      jgfs_gempak_meta: !Task
        <<: *exclusive_task_template
        Trigger: !Depend up.jgfs_analysis
        resources: !calc ( doc.resource_demo.run_nothing )

#     jgfs_pgrb2_spec_gempak: !Task
#       <<: *exclusive_task_template
#       Trigger: !Depend up.post.jgfs_pgrb2_spec_post
#       resources: !calc ( doc.resource_demo.run_nothing )
    #endfamily gempak

  #endfamily gfs

  gdas: !Family
    ecflow_def: |
      edit ECF_JOB_CMD 'lsub %ECF_JOB% %ECF_JOBOUT% %MACHINE%'
      edit ECF_FILES '{doc.settings.ECF_HOME}/scripts'
      edit PROJ '%PROJENVIR%'
      edit MODEL_NAME 'gdas'

    jgdas_verfrad: !Task
      <<: *exclusive_task_template
      Trigger: !Depend enkf
      resources: !calc ( doc.resource_demo.run_nothing )

    jgdas_vminmon: !Task
      <<: *exclusive_task_template
      Trigger: !Depend analysis.jgdas_analysis_high
      resources: !calc ( doc.resource_demo.run_nothing )

    dump: !Family
      jgdas_ics: !Task
        <<: *exclusive_task_template
        release_gdas00_ics: !DataEvent {file="/dev/null"}
        resources: !calc ( doc.resource_demo.run_nothing )

      #jgdas_dump_post: !Task
      #  Trigger: !Depend jgdas_dump
      #  release_sfcprep: !DataEvent {file="/dev/null"}
      #  release_gdas00_dump_alert: !DataEvent {file="/dev/null"}
      #  ecf_file: *ecf_file_template
      #  resources: !calc ( doc.resource_demo.run_nothing )
      #  accounting: *exclusive_accounting
      #  J_JOB: nothing
 
      jgdas_tropcy_qc_reloc: !Task
        <<: *exclusive_task_template
        Trigger: !Depend jgdas_dump
        #Time: !timedelta +5:50:00
        resources: !calc ( doc.resource_demo.run_nothing )

      #Replaced by emc version of dump job 
      #This dump job should be using NCO version when delivery to NCO
      jgdas_dump: !Task
        <<: *exclusive_task_template
        release_sfcprep: !DataEvent {file="/dev/null"}
        #Time: !timedelta +6:20:00
        resources: !calc ( doc.resource_demo.run_nothing )

    prep: !Family
      jgdas_emcsfc_sfc_prep: !Task
        <<: *exclusive_task_template
        Trigger: !Depend up.dump.jgdas_dump.release_sfcprep
        resources: !calc ( doc.resource_demo.run_nothing )

      jgdas_prep: !Task
        #Trigger: !Depend (up.dump.jgdas_dump & up.dump.jgdas_tropcy_qc_reloc & up.gdas.post.at('-6:00:00') )
        <<: *exclusive_task_template
        Trigger: !Depend ( up.dump.jgdas_dump & up.dump.jgdas_tropcy_qc_reloc )
        resources: !calc ( doc.resource_demo.run_prep )

      jgdas_prep_post: !Task
        <<: *exclusive_task_template
        Trigger: !Depend up.analysis.jgdas_analysis_high
        resources: !calc ( doc.resource_demo.run_nothing )

    analysis: !Family
      jgdas_analysis_high: !Task
        <<: *exclusive_task_template
        #Trigger: !Depend ( up.prep.jgdas_prep & up.prep.jgdas_emcsfc_sfc_prep & up.enkf.jgdas_enkf_post.at('-6:00:00') )
        Trigger: !Depend ( up.prep.jgdas_prep & up.prep.jgdas_emcsfc_sfc_prep )
        release_fcst: !DataEvent {file="/dev/null"}
        resources: !calc ( doc.resource_demo.run_anal )

    forecast: !Family
      #jgdas_forecast_high: !Task
      #  <<: *exclusive_task_template
      #  Trigger: !Depend ( up.analysis.jgdas_analysis_high.release_fcst & up.enkf.innovate )
      #  release_fcst: !DataEvent {file="/dev/null"}
      #  resources: !calc ( doc.resource_demo.run_gdasfcst )
      #  J_JOB: JGLOBAL_FORECAST

      jgdas_forecast: !Task
        <<: *exclusive_task_template
        Trigger: !Depend ( up.analysis.jgdas_analysis_high.release_fcst & up.enkf.innovate )
        release_fcst: !DataEvent {file="/dev/null"}
        resources: !calc ( doc.resource_demo.run_gdasfcst )
        J_JOB: JGLOBAL_FORECAST

    post_processing: !Family
      bulletins: !Family
        jgdas_mknavybulls: !Task
          <<: *exclusive_task_template
          #Trigger: !Depend ( up.up.dump.jgdas_dump_post )
          Trigger: !Depend ( up.up.dump.jgdas_dump )
          resources: !calc ( doc.resource_demo.run_nothing )

    gempak: !Family
      jgdas_gempak: !Task
        <<: *exclusive_task_template
        Trigger: !Depend up.forecast.jgdas_forecast
        resources: !calc ( doc.resource_demo.run_nothing )

      jgdas_gempak_meta: !Task
        <<: *exclusive_task_template
        Trigger: !Depend jgdas_gempak
        resources: !calc ( doc.resource_demo.run_nothing )

      jgdas_gempak_ncdc: !Task
        <<: *exclusive_task_template
        Trigger: !Depend jgdas_gempak
        resources: !calc ( doc.resource_demo.run_nothing )
    #endfamily gempak

    post: !Family
      #jgdas_post_high: !Task
      #  <<: *exclusive_task_template
      #  Trigger: !Depend up.forecast.jgdas_forecast_high
      #  resources: !calc ( doc.resource_demo.run_gdaspost )
      #  J_JOB: post
      #jgdas_post_hrly_high: !Task
      #  <<: *exclusive_task_template
      #  Trigger: !Depend up.forecast.jgdas_forecast_high
      #  resources: !calc ( doc.resource_demo.run_gdaspost )
      #  J_JOB: post
      jgdas_post: !Task
        <<: *exclusive_task_template
        Trigger: !Depend up.forecast.jgdas_forecast
        resources: !calc ( doc.resource_demo.run_gdaspost )
        J_JOB: post
    #endfamily post

    enkf: !Family
      jgdas_enkf_select_obs: !Task
        <<: *exclusive_task_template
        Trigger: !Depend  ( up.prep.jgdas_prep & jgdas_enkf_post.at('-6:00:00') )
        resources: !calc ( doc.resource_demo.run_eobs )

      innovate: !TaskArray
        Trigger: !Depend jgdas_enkf_select_obs
        Dimensions:
          groupid: !calc tools.seq(1,doc.settings.ENKF_INNOVATE_GROUPS,1)
        jgdas_enkf_innovate_obs_grp: !TaskElement
          <<: *exclusive_task_template
          Foreach: [ groupid ]
          Name: !expand "jgdas_enkf_innovate_obs_grp{idx.groupid}"
          resources: !calc ( doc.resource_demo.run_eomg )
          J_JOB: JGDAS_INNOVATE

      jgdas_enkf_update: !Task
        <<: *exclusive_task_template
        ecflow_def: |
          edit ECF_PASS 'FREE'
        Trigger: !Depend innovate
        resources: !calc ( doc.resource_demo.run_eupd )

      jgdas_enkf_inflate_recenter: !Task
        <<: *exclusive_task_template
        Trigger: !Depend ( jgdas_enkf_update & up.analysis.jgdas_analysis_high )
        resources: !calc ( doc.resource_demo.run_ecen )

      forecast: !TaskArray
        Trigger: !Depend up.enkf.jgdas_enkf_inflate_recenter
        Dimensions:
          groupid: !calc tools.seq(1,doc.settings.ENKF_FORECAST_GROUPS,1)
        jgdas_enkf_fcst_grp: !TaskElement
          <<: *exclusive_task_template
          Foreach: [ groupid ]
          Name: !expand "jgdas_enkf_fcst_grp{idx.groupid}"
          resources: !calc ( doc.resource_demo.run_efcs )
          J_JOB: JGLOBAL_FORECAST
          
      jgdas_enkf_post: !Task
        <<: *exclusive_task_template
        Trigger: !Depend forecast
        resources: !calc ( doc.resource_demo.run_epos )

    #endfamily enkf

  #endfamily gdas

  cycle_end: !Task
   ecflow_def: !expand |
     edit ECF_JOB_CMD '%ECF_JOB% 1> %ECF_JOBOUT% 2>&1'
     edit ECF_PASS 'FREE'
   <<: *exclusive_task_template
   #time 23:00
   #Time: !timedelta +23:00:00
   resources: !calc ( doc.resource_demo.run_nothing )

  #hpss archive tasks are run in the hpss_archive suite 
  #archive: !Family
  #  gdasarch: !Task
  #    <<: *shared_task_template
  #    Trigger: !Depend up.gdas.jgdas_verfrad
  #    resources: !calc ( doc.resource_demo.run_arch )
  #    J_JOB: gdasarch

  #  gfsarch: !Task
  #    <<: *shared_task_template
  #    Trigger: !Depend up.gfs.jgfs_vrfy
  #    resources: !calc ( doc.resource_demo.run_arch )
  #    J_JOB: gfsarch

  #  earc: !TaskArray
  #    Trigger: !Depend up.gdas.enkf.jgdas_enkf_post
  #    Dimensions:
  #      groupid: !calc tools.seq(1,doc.settings.ENKF_ARCHIVE_GROUPS,1)
  #    grp: !TaskElement
  #      <<: *shared_task_template
  #      Foreach: [ group ]
  #      Name: !expand "grp{idx.groupid}"
  #      resources: !calc ( doc.resource_demo.run_arch )
  #      J_JOB: earc

  final: !Task
    <<: *shared_task_template
    resources: !calc ( doc.resource_demo.run_nothing )

